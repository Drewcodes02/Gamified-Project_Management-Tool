<div class="dashboard-widgets row text-center">
  <div class="col-md-3 mb-4">
    <div class="widget bg-primary p-3">
      <h5>Tasks Completed</h5>
      <p id="tasks-completed">Loading...</p>
    </div>
  </div>
  <div class="col-md-3 mb-4">
    <div class="widget bg-success p-3">
      <h5>Total Points</h5>
      <p id="total-points">Loading...</p>
    </div>
  </div>
  <div class="col-md-3 mb-4">
    <div class="widget bg-info p-3">
      <h5>Task Progress</h5>
      <div class="progress">
        <div id="task-progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
      </div>
    </div>
  </div>
  <div class="col-md-3 mb-4">
    <div class="widget bg-warning p-3">
      <h5>Messages</h5>
      <p id="messages-count">3</p>
    </div>
  </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Fetch Total Tasks Completed
  fetch('/analytics/totalTasksCompleted')
    .then(response => response.json())
    .then(data => {
      document.getElementById('tasks-completed').textContent = data.totalTasksCompleted;
    })
    .catch(error => {
      console.error('Error fetching tasks completed:', error);
      document.getElementById('tasks-completed').textContent = 'Error loading data';
    });

  // Fetch Total Points
  fetch('/gamification/points')
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(data => {
      if (data.points !== undefined) {
        document.getElementById('total-points').textContent = data.points;
      } else {
        document.getElementById('total-points').textContent = 'No data';
      }
    })
    .catch(error => {
      console.error('Error fetching gamification points:', error);
      document.getElementById('total-points').textContent = 'Error loading data';
    });

  // Fetch Task Progress
  fetch('/dashboard/data')
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(data => {
      const progressBar = document.getElementById('task-progress-bar');
      progressBar.style.width = data.taskProgress + '%';
      progressBar.setAttribute('aria-valuenow', data.taskProgress);
      progressBar.textContent = data.taskProgress + '%';
    })
    .catch(error => {
      console.error('Error fetching dashboard data:', error);
      const progressBar = document.getElementById('task-progress-bar');
      progressBar.textContent = 'Error loading data';
    });
});
</script>